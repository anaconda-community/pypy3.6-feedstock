# Node ID 79776d971f8c4fdaf148ae2c816fa7fe25405238
# Parent  0788a72db0243e40fcc7e8a3e8c428777feeafd2
customize compiler

diff -r 0788a72db024 -r 79776d971f8c lib_pypy/_pypy_testcapi.py
--- a/lib_pypy/_pypy_testcapi.py	Sat Jun 19 23:15:30 2021 +0300
+++ b/lib_pypy/_pypy_testcapi.py	Mon Jun 21 04:43:09 2021 +0300
@@ -61,7 +61,7 @@
     assert output_dir is not None
 
     from distutils.ccompiler import new_compiler
-    from distutils import log
+    from distutils import log, sysconfig
     log.set_verbosity(3)
 
     compiler = new_compiler()
@@ -72,6 +72,7 @@
         ccflags = ['-D_CRT_SECURE_NO_WARNINGS']
     else:
         ccflags = ['-fPIC', '-Wimplicit-function-declaration']
+    sysconfig.customize_compiler(compiler)
     res = compiler.compile([os.path.join(thisdir, csource)],
                            include_dirs=[include_dir],
                            extra_preargs=ccflags,
